!function(e,t){"object"==typeof exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t({browserGlobal:!0},e)}(this,(function(e,t){"use strict";var i=["version","setLogLevel","getTable","checkTable","free","charSize","setDataPath","getDataPath","getFilesystem","registerLogCallback","backTranslateString","translateString","compileString","loadTable","enableOnDemandTableLoading","disableOnDemandTableLoading"],r="undefined"!=typeof window,o="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,n=!r&&!o,a={2:{getBufferLength:function(e){return 2*(e.length+1)},transfer:function(e,t){var i=a[2].getBufferLength(t),r=e._malloc(i);return e.stringToUTF16(t,r,i),r},read:function(e,t,i){if(i){var r=t>>1,o=r+e.getValue(i,"i32");return e.HEAPU16.slice(r,o)}return e.UTF16ToString(t)},buffToString:function(e){return String.fromCharCode.apply(null,e)}},4:{getBufferLength:function(e){return 4*(e.length+1)},transfer:function(e,t){var i=a[4].getBufferLength(t),r=e._malloc(i);return e.stringToUTF32(t,r,i),r},read:function(e,t,i){if(i){var r=t>>2,o=r+e.getValue(i,"i32");return e.HEAPU32.slice(r,o)}return e.UTF32ToString(t)},buffToString:function(e){for(var t="",i=0;i<e.length;++i){var r=e[i];if(r>=65536){var o=r-65536;t+=String.fromCharCode(55296|o>>10,56320|1023&o)}else t+=String.fromCharCode(r)}return t}}},l={};function s(){}function c(){return n?require("liblouis-build"):"undefined"!=typeof liblouisBuild?liblouisBuild:"undefined"!=typeof liblouis_emscripten?liblouis_emscripten:"undefined"!=typeof Module?Module:null}function u(e){if(n)throw new Error("Async API is only available in browser environments.");var t;this.registerLogCallback(null),this.callId=1,this.cbs={0:function(){}},this.worker=(t=new Blob([["var CMD = {","init: function(path) {","importScripts(path.capi);","importScripts(path.easy-api);","liblouis.registerLogCallback(function(logLevel, msg){","self.postMessage({isLog: true, level: liblouis.LOG[logLevel], msg: msg});","});","},","lou: function(data) {","if(LiblouisEasyApi.prototype.hasOwnProperty(data.fn) && typeof liblouis[data.fn] == 'function') {","return liblouis[data.fn].apply(liblouis, data.args);","}","return null","}","};","self.onmessage = function (ev) {","var msg = ev.data;","if(!msg.cmd || !CMD.hasOwnProperty(msg.cmd)) {","return;","}","var res = CMD[msg.cmd](msg.data);","self.postMessage({","callId: msg.callId,","data: res","});","};"].join("\n")],{type:"text/javascript"}),new Worker(window.URL.createObjectURL(t)));var i=this;this.worker.addEventListener("message",(function(e){i.resolveDispatch(e.data)}));var o="";r&&(o=window.location.origin+"/"),this.worker.postMessage({cmd:"init",callId:0,data:{capi:o+e.capi,easyapi:o+e.easyapi}})}l.lou={version:function(){return this.capi.ccall("lou_version","string",[],[])},setLogLevel:function(e){return this.capi.ccall("lou_setLogLevel","void",["number"],[e])},getTable:function(e){return this.capi.ccall("lou_getTable","number",["string"],[e])},checkTable:function(e){return this.capi.ccall("lou_checkTable","number",["string"],[e])},free:function(){return this.capi.ccall("lou_free","void",[],[])},charSize:function(){return this.capi.ccall("lou_charSize","number",[],[])},setDataPath:function(e){this.capi.ccall("lou_setDataPath","number",["string"],[e])},getDataPath:function(){return this.capi.ccall("lou_getDataPath","string",[],[])},getFilesystem:function(){return this.capi.FS},compileString:function(e,t){return!!this.capi.ccall("lou_compileString","number",["string","string"],[e,t])},registerLogCallback:function(e){this.capi._log_callback_fn_pointer&&this.capi.Runtime.removeFunction(this.capi._log_callback_fn_pointer),null===e&&(e=d);var t=this;this.capi._log_callback_fn_pointer=this.capi.Runtime.addFunction((function(i,r){e(i,t.capi.Pointer_stringify(r))})),this.capi.ccall("lou_registerLogCallback","void",["pointer"],[this.capi._log_callback_fn_pointer])},backTranslateString:function(e,t){return l.lou.translateString.call(this,e,t,!0)},translateString:function(e,t,i){if("string"!=typeof t||0===t.length)return"";var r=this.mem.transfer(this.capi,t),o=this.mem.getBufferLength(t),n=this.capi._malloc(o),a=this.capi._malloc(4),l=this.capi._malloc(4);if(this.capi.setValue(a,o,"i32"),this.capi.setValue(l,o,"i32"),!this.capi.ccall(i?"lou_backTranslateString":"lou_translateString","number",["string","number","number","number","number","number","number"],[e,r,l,n,a,null,null,0]))return null;var s=this.mem.read(this.capi,n,a);return this.capi._free(n),this.capi._free(r),this.capi._free(a),this.capi._free(l),this.mem.buffToString(s)},enableOnDemandTableLoading:function(e){if(r)throw new Error("This feature is only available in web workers and nodeJS");if(this.capi.TABLE_URL=e,n){this.disableOnDemandTableLoading(),this.capi.FS.mkdir("/tables");var t=e;if(!t){var i=require("path"),o=require.resolve("liblouis-build");t=i.resolve(i.dirname(o),"tables/")}try{this.capi.FS.mount(this.capi.FS.filesystems.NODEFS,{root:t},"/tables")}catch(e){throw console.error(e),new Error("mounting of table folder failed")}}else this.capi.FS.lookup=function(e){return e.capi.FS_ORIGINAL_LOOKUP||(e.capi.FS_ORIGINAL_LOOKUP=e.capi.FS.lookup),function t(i,r){var o;if(e.capi.FS.lookup=e.capi.FS_ORIGINAL_LOOKUP,/(\.cti|\.ctb|\.utb|\.dis|\.uti|\.tbl|\.dic)$/.test(r)){var n=e.capi.TABLE_URL+r;o=e.capi.FS.createLazyFile(i,r,n,!0,!0)}else o=e.capi.FS.lookup.apply(this,[i,r]);return e.capi.FS.lookup=t,o}}(this)},disableOnDemandTableLoading:function(){if(n){if(function(e,t){try{return e.FS.lookupPath("/tables"),!0}catch(e){return!1}}(this.capi)){try{this.capi.FS.unmount("/tables")}catch(e){}try{this.capi.FS.rmdir("/tables")}catch(e){throw new Error("removal of mounted table folder failed")}}}else this.capi.FS.lookup=this.capi.FS_ORIGINAL_LOOKUP}},l.lbu={version:function(){return capi.ccall("lbu_version","string",[],[])},free:function(){return capi.ccall("lbu_free","string",[],[])},setLogLevel:l.lou.setLogLevel,getTable:l.lou.getTable,checkTable:l.lou.checkTable,charSize:l.lou.charSize,setDataPath:l.lou.setDataPath,getDataPath:l.lou.getDataPath,getFilesystem:l.lou.getFilesystem,registerLogCallback:l.lou.registerLogCallback,compileString:l.lou.compileString},l.worker={registerLogCallback:function(e){this.logCallback=null===e?d:e},getFilesystem:function(){throw new Error("cannot get filesystem of async liblouis instance")},enableOnDemandTableLoading:function(e,t){r&&(e=window.location.origin+"/"+e),g(this,"enableOnDemandTableLoading",[e,t=t||s])}},u.prototype.resolveDispatch=function(e){e&&e.isLog?this.logCallback(e.level,e.msg):e&&"number"==typeof e.callId&&"function"==typeof this.cbs[e.callId]?(this.cbs[e.callId](e.data),this.cbs[e.callId]=null,delete this.cbs[e.callId]):console.debug("recieved bougus message from worker:",e)};for(var p=0;p<i.length;++p)u.prototype[i[p]]=l.worker[i[p]]||f(i[p]);function f(e){return function(){g(this,e,Array.prototype.slice.call(arguments))}}function g(e,t,i){i.length<1||(e.cbs[e.callId]=i[i.length-1],e.worker.postMessage({callId:e.callId,cmd:"lou",data:{args:i.slice(0,-1),fn:t}}),e.callId++)}function h(e){if("string"==typeof(e=e||c())){var t=h.getAvailableBuilds();if(!t.hasOwnProperty(e))throw new Error("no liblouis build for requested version loaded");e=t[e][0]}if("function"==typeof e&&(e=e()),!e||!e._lou_version)throw new Error("argument cannot be resolved to a liblouis build.");this.capi=e,this.impl=function(e){return void 0!==e._hasLbu?e._hasLbu:"function"==typeof e._lbu_version}(e)?l.lbu:l.lou,this.mem=4===this.charSize()?a[4]:a[2],this.registerLogCallback(null)}for(p=0;p<i.length;++p)h.prototype[i[p]]=b(i[p]);function b(e){return function(t,i,r){if(!this.impl.hasOwnProperty(e))throw new Error("Your build does not support this method. Include a build containing liblouisutdml.");return this.impl[e].call(this,t,i,r)}}function d(e,t){var i=h.prototype.LOG[e];if(t="["+i+"] "+t,"undefined"!=typeof console){var r=console[h.prototype._CONSOLE_MAPPING[i]];r?r(t):console.log(t)}}h.prototype.getAvailableBuilds=h.getAvailableBuilds=function(){return t.liblouisBuilds||{}},h.prototype.LOG={},h.prototype.LOG[h.prototype.LOG.ALL=0]="ALL",h.prototype.LOG[h.prototype.LOG.DEBUG=1e4]="DEBUG",h.prototype.LOG[h.prototype.LOG.INFO=2e4]="INFO",h.prototype.LOG[h.prototype.LOG.WARN=3e4]="WARN",h.prototype.LOG[h.prototype.LOG.ERROR=4e4]="ERROR",h.prototype.LOG[h.prototype.LOG.FATAL=5e4]="FATAL",h.prototype.LOG[h.prototype.LOG.OFF=6e4]="OFF",h.prototype._CONSOLE_MAPPING={ALL:"log",DEBUG:"log",INFO:"info",WARN:"warn",ERROR:"error",FATAL:"error"},h.prototype._defaultLogCallback=d,e.browserGlobal?(c()&&(t.liblouis=new h),t.LiblouisEasyApi=h,t.LiblouisEasyApiAsync=u):(e.EasyApi=h,e.EasyApiAsync=u)}));